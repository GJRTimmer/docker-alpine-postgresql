#!/bin/bash

source /etc/postgresql/env-defaults

PG_CONF=${PG_DATADIR}/postgresql.conf
PG_HBA_CONF=${PG_DATADIR}/pg_hba.conf
PG_IDENT_CONF=${PG_DATADIR}/pg_ident.conf
PG_RECOVERY_CONF=${PG_DATADIR}/recovery.conf

# -----------------------------------------------------------------------------

map_uid_gid() {
  USERMAP_ORIG_UID=$(id -u postgres)
  USERMAP_ORIG_GID=$(id -g postgres)
  PG_GID=${PG_GID:-${PG_UID:-$USERMAP_ORIG_GID}}
  PG_UID=${PG_UID:-$USERMAP_ORIG_UID}
  if [[ ${PG_UID} != ${USERMAP_ORIG_UID} ]] || [[ ${PG_GID} != ${USERMAP_ORIG_GID} ]]; then
    echo "Adapting uid and gid for ${PG_USER}:${PG_USER} to $PG_UID:$PG_GID"
    groupmod -o -g ${PG_GID} ${PG_USER}
    sed -i -e "s|:${USERMAP_ORIG_UID}:${PG_GID}:|:${PG_UID}:${PG_GID}:|" /etc/passwd
  fi
}

# -----------------------------------------------------------------------------


